---
title: "Project2019"
author: "Mirko Michovich"
date: "5/7/2019"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#install.packages("maps")
#install.packages("mapdata")
#install.packages("ggmap")
#install.packages("mapproj")
#install.packages("ggplot2")

library(maps)
library(mapdata)
library(ggmap) #use to read map
library(mapproj) #map tools kits
library(ggplot2) #read the map data
library(tidyverse)
library(stringr)

register_google(key = "AIzaSyARb0Fsx8OYgRVToJK_2Abl4r1lO_1ACCY", write = TRUE)

```


```{r}
collisions_subset_10000 <- read.csv("Collision 10000.csv")
#collisions_subset_10000 <- collisions[sample(nrow(collisions),10000),]

extract_numbers <- function(string){ 
  str_extract(string, "\\-*\\d+\\.*\\d*")
} 

collisions_subset_10000_renamed <- collisions_subset_10000 %>%
rename("Row original" = X,
       "Division of Records" = DR.Number,
       "Date Reported" = Date.Reported,
       "Date Occurred" = Date.Occurred,
       "Time Occurred" = Time.Occurred,
       "Area ID" = Area.ID,
       "Area Name" = Area.Name,
       "Reporting District" = Reporting.District,
       "Crime Code" = Crime.Code,
       "Crime Code Description" = Crime.Code.Description,
       "Modus Operandi Codes" = MO.Codes,
       "Victim Age" = Victim.Age,
       "Victim Sex" = Victim.Sex,
       "Victim Descent" = Victim.Descent,
       "Premise Code" = Premise.Code,
       "Premise Description" = Premise.Description,
       "Cross Street" = Cross.Street,
       "Zip Codes" = Zip.Codes,
       "Census Tracts" = Census.Tracts,
       "Precinct Boundaries" = Precinct.Boundaries,
       "LA Specific Plans" = LA.Specific.Plans,
       "Council Districts" = Council.Districts,
       "Neighborhood Councils" = Neighborhood.Councils..Certified.)%>%
  mutate(`Date Reported` = str_sub(`Date Reported`, 0, 10),
         `Date Occurred` = str_sub(`Date Occurred`, 0, 10),
         `Date Reported` = as.Date(`Date Reported`),
         `Date Occurred` = as.Date(`Date Occurred`))%>%
  separate(Location, c("Longitude","Latitude"), sep =',' )%>%
  mutate(Longitude = as.character(extract_numbers(Longitude)),
         Latitude = as.character(extract_numbers(Latitude)),
         Longitude = as.numeric(Longitude),
         Latitude = as.numeric(Latitude))

  

typeof(collisions_subset_10000_renamed$Longitude)

str(collisions_subset_10000_renamed)
#str(collisions_subset_10000_renamed)
view(collisions_subset_10000_renamed)
#write.csv(collisions_subset, "Collision 5000.csv")
#write.csv(collisions_subset_10000_renamed, "tidy_collisions.csv")

```

```{r}
LA_map <- get_map(location = "los angeles, california", zoom = 12)
ggmap(LA_map)
```

```{r}
#heatmap 

#morning crashes 
mapset1 <- collisions_subset_10000_renamed %>%
  select(`Crime Code Description`, Longitude, Latitude, `Time Occurred`) %>% 
  filter(`Crime Code Description` == 'TRAFFIC COLLISION') %>%
  filter(`Time Occurred` < 900) %>%
  na.omit()


#evening crashes 
mapset2 <- collisions_subset_10000_renamed %>%
  select(`Crime Code Description`, Longitude, Latitude, `Time Occurred`) %>% 
  filter(`Crime Code Description` == 'TRAFFIC COLLISION') %>%
  filter(`Time Occurred` > 1800) %>%
  na.omit()

ggmap(LA_map) + geom_density_2d()


ggmap(LA_map) + geom_density_2d(aes(x = Longitude, y = Latitude), data = mapset1) +
  stat_density2d(data = mapset1, 
    aes(x = Longitude, y = Latitude, fill = ..level.., alpha = ..level..), size = 0.01, 
    bins = 16, geom = "polygon") + scale_fill_gradient(low = "green", high = "red", 
    guide = FALSE) + scale_alpha(range = c(0, 0.3), guide = FALSE)


ggmap(LA_map) + geom_density_2d(aes(x = Longitude, y = Latitude), data = mapset2) +
  stat_density2d(data = mapset2, 
    aes(x = Longitude, y = Latitude, fill = ..level.., alpha = ..level..), size = 0.01, 
    bins = 16, geom = "polygon") + scale_fill_gradient(low = "green", high = "red", 
    guide = FALSE) + scale_alpha(range = c(0, 0.3), guide = FALSE)

```

```{r}
LA_map <- get_map(location = "los angeles, california", zoom = 12)
ggmap(LA_map)

#shiny app - interactive graph with buttons and sliders up top 
  
#heatmap and stuff below 
```




